<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Optional_syntax (odoc.core_kernel.Core_kernel.Optional_syntax_intf.Optional_syntax)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">odoc</a> &#x00BB; <a href="../../../index.html">core_kernel</a> &#x00BB; <a href="../../index.html">Core_kernel</a> &#x00BB; <a href="../index.html">Optional_syntax_intf</a> &#x00BB; Optional_syntax</nav><header class="odoc-preamble"><h1>Module type <code><span>Optional_syntax_intf.Optional_syntax</span></code></h1><p>Idiomatic usage is to have a module <code>M</code> like:</p><pre><code>module M : sig
  type t

  module Optional_syntax : Optional_syntax.S
    with type t := t
    with type value := ...
end = struct
  ...

  module Optional_syntax = struct
    module Optional_syntax = struct
      let is_none = is_none
      let unsafe_value = unsafe_value
    end
  end
end</code></pre><p>Then, uses look like:</p><pre><code>let open M.Optional_syntax in
match%optional m with
| None   -&gt; ?
| Some v -&gt; ?</code></pre><p>The reason for the double <code>module Optional_syntax</code> is so that <code>open M.Optional_syntax</code> puts in scope only <code>module Optional_syntax</code>; <code>match%optional</code> then expands to references to <code>Optional_syntax.is_none</code> and <code>Optional_syntax.unsafe_value</code>.</p><p><code>unsafe_value</code> does not have to be memory-safe if not guarded by <code>is_none</code>.</p><p>Implementations of <code>is_none</code> and <code>unsafe_value</code> must not have any side effects. More precisely, if you mutate any value currently being match'ed on (not necessarily your own argument) you risk a segfault as well.</p><p>This is because <code>match%optional</code> does not make any guarantee about <code>is_none</code> call being immediately followed by the corresponding <code>unsafe_value</code> call. In fact it makes several <code>is_none</code> calls followed by several <code>unsafe_value</code> calls, so in the presence of side-effects by the time it makes an <code>unsafe_value</code> call the result of the corresponding <code>is_none</code> can go stale.</p><p>For more details on the syntax extension, see <code>ppx/ppx_optional/README.md</code>.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module-type" id="module-type-S" class="anchored"><a href="#module-type-S" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> </span><span>S</span><span> = <a href="../module-type-S/index.html">S</a></span></code></div></div><div class="odoc-spec"><div class="spec module-type" id="module-type-S1" class="anchored"><a href="#module-type-S1" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> </span><span>S1</span><span> = <a href="../module-type-S1/index.html">S1</a></span></code></div></div><div class="odoc-spec"><div class="spec module-type" id="module-type-S2" class="anchored"><a href="#module-type-S2" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> </span><span>S2</span><span> = <a href="../module-type-S2/index.html">S2</a></span></code></div></div></div></body></html>